CREATE DATABASE QLTV
USE QLTV

CREATE TABLE THEDOCGIA
(
MATHEDG CHAR(10) NOT NULL,
HOTENDC NVARCHAR(40) NOT NULL,
GIOITINH BIT , 
NGAYSINH SMALLDATETIME ,
DIACHI NVARCHAR(50) ,
SODT INT ,
CONSTRAINT PK_MATHEDOCGIA PRIMARY KEY (MATHEDG)


)

CREATE TABLE SACH
(
MASACH CHAR(10) NOT NULL,
TENSACH NVARCHAR(20) NOT NULL,
NAMXB DATETIME ,
TENTACGIA NVARCHAR(30) NOT NULL,
SOLUONG INT,

CONSTRAINT PK_MASACH PRIMARY KEY (MASACH)


)
ALTER TABLE SACH ADD  NAMXB CHAR(10) 
CREATE TABLE PHIEUMUON
(

MAPHIEU CHAR(10) NOT NULL,
NGAYMUON DATETIME ,
MASACH CHAR(10) NOT NULL,
MATHEDG CHAR(10) NOT NULL,
NGAYTRA DATETIME,
CONSTRAINT PK_MAPHIEU PRIMARY KEY (MAPHIEU) ,
CONSTRAINT FK_MASACH FOREIGN KEY (MASACH) REFERENCES SACH(MASACH) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT FK_MATHEDG FOREIGN KEY (MATHEDG) REFERENCES  THEDOCGIA(MATHEDG) ON DELETE CASCADE ON UPDATE CASCADE


)

SELECT *FROM THEDOCGIA

INSERT INTO THEDOCGIA(MATHEDG,HOTENDC,NGAYSINH,DIACHI,SODT)
VALUES ('MT001', N'HOANG KHANG' , '07/07/2004' , N'BINH MINH ,VINH LONG ' , 0123456789)
INSERT INTO THEDOCGIA(MATHEDG,HOTENDC,NGAYSINH,DIACHI,SODT)
VALUES ('MT002', N'LE TAN DAT' , '11/10/2004' , N'BINH MINH ,VINH LONG ' , 0147258369)
INSERT INTO THEDOCGIA(MATHEDG,HOTENDC,NGAYSINH,DIACHI,SODT)
VALUES ('MT003', N'NGUYEN VAN AN' , '11/10/2004' , N'BINH MINH ,VINH LONG ' , 0147258369)


--INSERT BAGNG SACH

INSERT INTO SACH(MASACH,TENSACH,NAMXB,NHAXB,TENTACGIA,SOLUONG)
VALUES ('SACH001' ,N'CƠ SỞ DỮ LIỆU','2000','NAM CAN THO', N'NGUYEN PHAM' , 20)
INSERT INTO SACH(MASACH,TENSACH,NAMXB,NHAXB,TENTACGIA,SOLUONG)
VALUES ('SACH002' ,N'LẬP TRÌNH .NET','2014','NAM CAN THO', N'MICROSOFT' , 3)
 INSERT INTO SACH(MASACH,TENSACH,NAMXB,NHAXB,TENTACGIA,SOLUONG)
VALUES ('SACH001' ,N'CƠ SỞ DỮ LIỆU1','2000','NAM CAN THO', N'NGUYEN PHAM' , 10)
 DELETE PHIEUMUON

 INSERT INTO PHIEUMUON(MAPHIEU,NGAYMUON,MASACH,MATHEDG,NGAYTRA)
 VALUES ('PH001','11-16-2022','SACH001','MT001','11-23-2022')


  INSERT INTO PHIEUMUON(MAPHIEU,NGAYMUON,MASACH,MATHEDG,NGAYTRA)
 VALUES ('PH002','11-19-2022','SACH002','MT002','11-29-2022')

 INSERT INTO PHIEUMUON(MAPHIEU,NGAYMUON,MASACH,MATHEDG,NGAYTRA)
 VALUES ('PH003','11-19-2022','SACH002','MT003','10-24-2022')
  INSERT INTO PHIEUMUON(MAPHIEU,NGAYMUON,MASACH,MATHEDG,NGAYTRA)
 VALUES ('PH004','10-24-2021','SACH002','MT003','10-24-2022')
 UPDATE THEDOCGIA   SET DIACHI = 'NINH KIEU , CAN THO' , MATHEDG ='MT001'  WHERE  DIACHI = 'BINH MINH ,VINH LONG' AND MATHEDG='MT001'
  UPDATE THEDOCGIA   SET  HOTENDC = 'LE TAN DAT' WHERE  DIACHI = 'NINH KIEU ,CAN THO' AND HOTENDC= 'NGUYEN HOANG KHANG' 


SELECT *FROM THEDOCGIA


DELETE FROM SACH WHERE YEAR(GETDATE()) - NAMXB >=20;


ALTER TABLE PHIEUMUON ADD NGAYGIAHAN DATE

ALTER TABLE  PHIEUMUON ADD CONSTRAINT CK_NGAYGIAHAN CHECK(NGAYGIAHAN = NGAYTRA +7)

UPDATE  THEDOCGIA
SET SOLUONG = SOLUONG - SOLUONG * 0.5
WHERE NAMXB = '2000'


UPDATE SACH SET NHAXB = N'GIÁO DỤC CẦN THƠ' WHERE NHAXB ='NAM CAN THO'


DELETE FROM PHIEUMUON WHERE 
MATHEDG IN (SELECT MATHEDG FROM THEDOCGIA WHERE 
HOTENDC = N'NGUYEN VAN AN' AND NGAYMUON ='11-19-2022');
